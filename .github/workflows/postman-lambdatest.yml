name: Postman Collection - LambdaTest

on:
  workflow_dispatch:

jobs:
  run-postman-lambdatest:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v5

      - name: Install LambdaTest HyperExecute
        run: |
          curl -fsSL https://downloads.lambdatest.com/hyperexecute/linux/hyperexecute -o hyperexecute
          chmod +x hyperexecute
          sudo mv hyperexecute /usr/local/bin/hyperexecute

      - name: Verify HyperExecute installation
        run: hyperexecute --version

      - name: Validate LambdaTest credentials exist
        env:
          LT_USERNAME: ${{ secrets.LT_USERNAME }}
          LT_ACCESS_KEY: ${{ secrets.LT_ACCESS_KEY }}
        run: |
          if [ -z "$LT_USERNAME" ]; then
            echo "LT_USERNAME is empty ❌"
            exit 1
          fi

          if [ -z "$LT_ACCESS_KEY" ]; then
            echo "LT_ACCESS_KEY is empty ❌"
            exit 1
          fi

          echo "LambdaTest credentials are present ✅"

      - name: Run Postman Collection on LambdaTest
        env:
          LT_USERNAME: ${{ secrets.LT_USERNAME }}
          LT_ACCESS_KEY: ${{ secrets.LT_ACCESS_KEY }}
        run: |
          hyperexecute --user "$LT_USERNAME" --key "$LT_ACCESS_KEY" --config hyperexecute.yaml
